# Complete GitHub Actions Workflow - No Package.json Required
name: Universal Demo Workflow

# Triggers (list of events)
on:
  push:
    branches:
      - main
      - develop
  pull_request:
  workflow_dispatch:

# Environment variables
env:
  DEPLOY_ENABLED: false
  MAX_RETRIES: 3

# Jobs section
jobs:
  # First job: build and test
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    continue-on-error: false

    # Steps (list of actions)
    steps:
      # Step 1: Checkout code
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Step 2: Display environment info
      - name: Display Environment
        run: |
          echo "=== System Information ==="
          echo "Operating System: $(uname -s)"
          echo "Architecture: $(uname -m)"
          echo "Working Directory: $(pwd)"
          echo "Git SHA: ${{ github.sha }}"
          echo "Git Ref: ${{ github.ref }}"

      # Step 3: List project files
      - name: List Project Files
        run: |
          echo "=== Project Structure ==="
          ls -la
          echo "=== File Details ==="
          find . -type f -name "*.*" | head -20

      # Step 4: Run basic tests
      - name: Run Basic Tests
        run: |
          echo "=== Running Basic Tests ==="
          
          # Test 1: Check for common file types
          echo "1. Checking for common files:"
          if [ -f "README.md" ]; then
            echo "   ✓ README.md found"
          else
            echo "   ⚠ README.md not found"
          fi
          
          if [ -f ".gitignore" ]; then
            echo "   ✓ .gitignore found"
          else
            echo "   ⚠ .gitignore not found"
          fi
          
          # Test 2: Check directory structure
          echo "2. Checking directory structure:"
          echo "   Current files count: $(find . -type f | wc -l)"
          echo "   Current directories count: $(find . -type d | wc -l)"
          
          # Test 3: Simple validation
          echo "3. Running validations:"
          echo "   ✓ Workflow syntax is correct"
          echo "   ✓ GitHub Actions is executing properly"
          echo "   ✓ Basic shell commands are working"
          
          echo "All basic tests completed successfully!"

      # Step 5: Simulate build process
      - name: Simulate Build Process
        run: |
          echo "=== Simulating Build Process ==="
          
          # Create a simple build artifact
          echo "Creating build artifacts..."
          mkdir -p dist
          echo "Build date: $(date)" > dist/build-info.txt
          echo "Commit: ${{ github.sha }}" >> dist/build-info.txt
          echo "Repository: ${{ github.repository }}" >> dist/build-info.txt
          
          # Create a simple script as build output
          cat > dist/deploy.sh << 'EOF'
          #!/bin/bash
          echo "Deployment script generated by GitHub Actions"
          echo "This would deploy your application"
          echo "Generated from commit: ${{ github.sha }}"
          EOF
          
          chmod +x dist/deploy.sh
          
          echo "Build artifacts created:"
          ls -la dist/
          echo "Build simulation completed!"

      # Step 6: Display summary
      - name: Display Summary
        run: |
          echo "=== Workflow Summary ==="
          echo "Workflow: ${{ github.workflow }}"
          echo "Repository: ${{ github.repository }}"
          echo "Triggered by: ${{ github.event_name }}"
          echo "Environment Variables:"
          echo "  - DEPLOY_ENABLED: ${{ env.DEPLOY_ENABLED }}"
          echo "  - MAX_RETRIES: ${{ env.MAX_RETRIES }}"
          echo "Job: build"
          echo "Status: ✅ SUCCESS"
          echo "All tasks completed without Node.js or package.json!"

  # Second job: deploy simulation
  deploy:
    needs: build
    if: ${{ vars.DEPLOY_ENABLED == 'true' }}
    
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Simulate Deployment
        run: |
          echo "=== Deployment Simulation ==="
          echo "This job only runs when DEPLOY_ENABLED is set to 'true'"
          echo "Current DEPLOY_ENABLED value: ${{ env.DEPLOY_ENABLED }}"
          echo "To enable deployment, set DEPLOY_ENABLED: true in the env section"
          echo "Deployment simulation completed!"
